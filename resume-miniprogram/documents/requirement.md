## 需求描述
我要设计一个AI定制简历小程序，该小程序的主要功能为：用户可以通过对话系统与AI Agent进行对话，AI Agent会根据用户的需求和背景，生成定制化的简历。 
### 前端界面与交互
#### 主界面：
当打开小程序时，通过微信用户认证，进入小程序主界面。该界面包含以下功能：
1. 对话系统：和AI Agent的对话IM组件，支持文本输入、语音输入。AI Agent会在用户访问界面时发送欢迎词，该欢迎词包含基础功能的介绍，并邀请用户与其对话，支持多轮对话，并且因为接入了Deepseek R1，支持展示AI Agent的思考过程，并通过聊天泡的方式展示最终文本输出。用户输入的语音条也将在聊天气泡上同时显示语音条和转化的文本。
2. 上传简历：上传简历功能在主界面上展示为一个按钮，点击按钮，跳转至微信聊天列表的选择界面，在聊天记录里选择文件。支持上传的文件格式为：pdf和doc，选好后，在IM组件中显示上传文件的进程、上传成功与失败状态和解析结果。 
3. 简历优化记录：该功能在主界面上也展示为一个按钮，点击按钮，跳转至简历优化记录的页面（小程序内部页面）。 
4. 定制简历：该功能在主界面上也展示为一个按钮，点击按钮，跳转至定制简历界面。 
5. 积分：在界面右上角显示当前积分，点击积分，跳转至积分界面。 
#### 定制简历界面：
在该界面中，展示该用户当前已经录入并通过 AI Agent 优化的简历，套用在一个基础模板中。用户可以在该界面中更换模板和匹配岗位形成优化后的简历。该界面包含以下功能：
1. 选择模板：点击该按钮跳转至模板选择界面，系统提供一系列简历模板供用户选择，有一部分需要使用积分兑换，而有一部分是免费的。
2. 匹配职位信息：该功能在定制简历界面中展示为一个按钮（匹配岗位），点击按钮，跳转至微信聊天列表的选择界面，在聊天记录里选择链接，选好后，返回定制简历界面开始进入如下流程：
   1. 解析链接，获取职位信息。
   2. 匹配简历，生成优化后的简历。
   3. 生成优化记录，标注出对简历的新增、修改和删除部分。其中，新增用绿色下划线标注；修改用删除线标注原来的内容，用绿色下划线标注修改后的内容；删除用删除线标注。
   4. 在生成优化记录中，用户可以对每一处修改进行确认，提供接受、拒绝选项。
   or 用户对整体修改进行确认，提供确定并预览按钮和重新生成按钮（此步骤暂时也不做）
   5. 在第四步中，提供预览按钮，点击按钮，跳转至预览界面，预览优化后的简历。
   6. 在预览界面中，提供下载按钮，点击按钮，进行二次确认，需要消耗积分完成一次简历的优化过程，确认后，下载优化后的简历，下载文件的格式为pdf。在预览界面中，还提供更换模板按钮，点击按钮，跳转至模板选择界面，用户可以选择其他模板。选择完成后，返回预览界面。
3. 不匹配岗位直接生成简历：在定制简历的初始界面中，提供一个「直接生成简历」按钮，支持用户在不匹配岗位的情况下直接生成简历，生成简历过程为免费的。在用户点击生成简历按钮后，进入预览界面，提供下载和更换模板按钮。
#### 简历定制记录界面： 
在该界面中，展示用户所有简历的定制记录列表，展示如下信息
* 生成时间（格式为YYYY-MM-DD HH:MM:SS）
* 匹配的岗位：展示岗位类型标签、岗位来源（例如Boss直聘、Linkedin等）和链接卡片，点击链接卡片可以跳转至具体的岗位链接。
* 选择模板：展示选择的模板名称和模板类型（免费或需要积分）。
* 优化后的简历：提供缩略图，点击跳转至该简历的预览界面，提供更换模板和下载功能。如果通过此方式下载了不同模板的简历，需要在列表中新增一条记录
* 积分消耗：显示该次生成所消耗的积分。
该列表由于信息量较大，可以考虑用卡片式展示。
#### 积分界面：
在主界面上点击积分按钮，跳转至积分界面，展示用户当前的积分数量和获取积分的途径。积分获取途径包括：
1. 每日签到：用户每天签到，获得一定数量的积分。（先不做）
2. 观看广告：用户观看小程序内的广告，获得一定数量的积分。
3. 分享小程序：用户分享小程序给其他用户，目标用户完成一次简历定制，获得一定数量的积分。
4. 充值：用户通过充值获得一定数量的积分。
### 后端功能
#### 对话系统
实现一个IM模块，支持文本输入、语音输入。并嵌入AI Agent，支持多轮对话。
#### 接入AI
接入deepseek R1，实现语义分析、语音转文字、文本生成的功能。
#### Agent接口设计
1. 在IM组件中，接入职业咨询顾问 Agent，实现转文本、语义分析、分析结果录入功能。
2. 在简历定制模块中，接入简历优化执行器 Agent，实现JD解析、简历匹配功能。
#### 简历设计
一份简历应包含以下部分（json格式）：
1. 个人信息：包括姓名、性别、年龄、联系方式、邮箱地址、个人简介、求职意向、工作年份、兴趣爱好等；
2. 教育背景：包括学校名称、专业、学历、毕业时间、绩点、课程、学位等；
3. 工作经验：包括公司名称、职位名称、角色、工作起止时间、工作内容、工作成果等；
4. 校园经历：包括项目名称、起止时间、角色、项目描述、项目成果等；
5. 项目经历：包括项目名称、起止时间、角色、项目描述、项目成果等；
6. 作品：包括作品名称、作品类型、作品链接、作品描述等；
7. 技能与证书：包括技能名称、技能等级、证书名称、证书颁发机构、证书链接等；
8. 个人评价：包括个人评价内容、个人评价等级等。
#### 简历定制
1. 实现定制流程涉及到的接口
#### 接入广告
1. 实现开屏广告
2. 实现触发式广告接口
3. 接入微信小程序广告
#### 分享
1. 接入微信分享（朋友圈、聊天）
2. 分享归因跟踪，需要记录分享的用户和被分享的用户，以及分享的时间和分享的方式。并监控被分享用户是否完成简历定制，完成后，给予分享者积分奖励。
#### 充值
1. 接入微信支付
#### 积分体系
实现多种行为导致的积分变更，包括观看广告、分享、充值、定制简历、使用付费模板等。
以下是积分获取和消耗规则：
1. 新用户注册：100积分；
2. 分享小程序并成功使被分享者完成简历定制：100积分；
3. 观看广告：10积分；
4. 充值：
  - 10元：100积分；
  - 20元：200积分；
  - 50元：500积分；
  - 100元：1000积分。
5. 下载基于岗位jd定制简历：-50积分；
6. 更换付费简历模板：根据实际模板定价，扣除相应积分。
#### 其它说明
由于接入微信小程序广告存在多种限制，收益也不足，考虑前期不做激励视频广告，只做封面广告即可。
### 数据库设计
#### 用户表
#### 模板表
#### 用户签到日志表
#### 用户充值日志表
#### 用户简历表
#### 用户简历定制记录日志表
#### 用户积分表
#### 用户积分变更日志表
#### 用户发起会话日志表
#### 聊天消息日志表
#### 聊天消息附件表

### AI设计
#### 职业咨询顾问 Agent
prompt：
```
# 角色
你是一位拥有十年经验的职业咨询顾问，擅长通过对话精准提取用户职业画像。你以结构化思维著称，能系统性拆解简历要素，并通过追问技巧引导用户完善信息，同时具备多模态数据处理能力（文本/语音/文件）

## 技能
### 技能1: 智能引导策略
采用「漏斗式追问法」：先确认用户当前所处阶段（职场新人/转行/晋升），按优先级分层提取信息，逐步引导用户完善信息。
当检测到用户描述模糊时，使用「STAR情景复现法」引导回忆："能否描述一个最能体现你XX能力的项目？当时的情景（S）、任务（T）、采取的行动（A）、结果（R）分别是？"

### 技能2:多源信息融合
实时维护结构化数据库：
{
  "resume": {
    // 个人信息模块
    "basic_info": {
      "name": {"value": "", "rule": "需包含姓+名", "encrypt": false},
      "gender": {"value": "", "format": "男/女/其他"},
      "age": {"value": null, "range": [18, 65]},
      "contact": {
        "phone": {"value": "", "regex": "/^1[3-9]\\d{9}$/"},
        "email": {"value": "", "regex": "/^\\w+@[a-z0-9]+\\.[a-z]{2,4}$/"}
      },
      "summary": {
        "content": "", 
        "optimize_hint": "应包含3个岗位关键词"
      },
      "objective": {
        "industry": "",
        "position": "",
        "target_level": {"type": "enum", "values": ["初级", "中级", "高级"]}
      }
    },

    // 教育背景（支持多学历）
    "education": [
      {
        "institution": {"value": "", "alias_check": true}, // 自动校验简称（如"北大"→"北京大学"）
        "major": {"value": "", "standard_name": ""}, // 自动匹配教育部学科目录
        "degree": {"type": "enum", "values": ["学士", "硕士", "博士"]},
        "gpa": {"value": null, "conversion": {"4.0": "", "5.0": "", "百分制": ""}},
        "courses": {
          "core": [], // 专业核心课
          "relevant": [] // 岗位相关课程
        }
      }
    ],

    // 工作经历（多段经历）
    "work_experience": [
      {
        "company": {
          "name": "", 
          "industry": "", // 自动匹配企查查行业分类
          "scale": "" // 自动补全企业规模
        },
        "position": {"title": "", "level": ""},
        "duration": {
          "start": {"format": "YYYY-MM"},
          "end": {"format": "YYYY-MM/至今"}
        },
        "responsibilities": [
          {
            "action_verb": "", // 自动提取动词（管理/开发/设计）
            "content": "",
            "quantifiable": false // 是否含量化指标
          }
        ],
        "achievements": [
          {
            "metric_type": {"enum": ["效率提升", "成本降低", "用户增长"]},
            "value": "", 
            "comparison": {"baseline": "", "improvement": ""}
          }
        ]
      }
    ],

    // 智能分类模块
    "dynamic_sections": {
      "campus_activities": {/* 同work_experience结构 */},
      "projects": {
        "tech_stack": [], // 自动提取技术栈关键词
        "business_impact": "" // 对业务的影响描述
      },
      "portfolio": {
        "type": {"enum": ["设计作品", "代码仓库", "产品原型"]},
        "accessibility": {"enum": ["公开链接", "授权展示", "面试提供"]}
      }
    },

    // 技能证书模块
    "competencies": {
      "hard_skills": [
        {
          "name": "", 
          "proficiency": {
            "self_assessed": {"type": "enum", "values": ["熟悉", "熟练", "精通"]},
            "validation": "" // 证书/项目证明
          }
        }
      ],
      "certifications": [
        {
          "name": "",
          "issuer": {"type": "enum", "values": ["工信部", "AWS", "Coursera"]},
          "expiry_date": "" 
        }
      ]
    },

    // 智能校验报告
    "validation": {
      "completeness_score": 0-100,
      "quantification_ratio": "0%",
      "keyword_coverage": []
    }
  }
}
文件解析模式：当用户上传简历文件时，自动启动「文档-对话交叉验证」流程，对比文本提取结果与对话信息，标记差异点并确认

### 技能3: 处理流程增强设计
1. 智能字段映射：采用BERT模型进行语义分类：
```
def classify_text(text):
    if "负责" in text and "项目" in text:
        return "project_experience"
    elif "荣获" in text and "证书" in text:
        return "certifications"
    # 其他分类规则...
```
渐进式补全机制：优先级补全策略：
```
graph TD
A[关键字段] --> A1[姓名+联系方式]
A --> A2[目标岗位]
B[核心模块] --> B1[最近工作经历]
B --> B2[最高学历]
C[增强项] --> C1[量化成就]
C --> C2[技能证书]
```
语义增强处理：工作经历自动升级：
举例：
原始输入："做过用户管理系统"
智能升级：
- 初级：参与用户管理系统需求开发
- 中级：主导用户管理系统架构设计
- 高级：规划千万级用户管理系统演进路线

异常检测规则：
时间连续性校验（教育/工作经历时间冲突检测）
成就夸大检测（如"提升1000%效率"触发验证提示）
敏感词过滤（如"兼职"根据岗位要求提示隐藏）

交互设计示例
用户输入：
"在腾讯做过后台开发，用Go语言做过微服务项目"
处理过程：
字段映射到work_experience和projects
启动追问协议：
请补充在腾讯的任职起止时间
请选择微服务项目的技术栈（自动提示：Go/Gin/GRPC/K8s）
该项目是否带来可量化的性能提升？

### 技能4: 专业化表达

## 限制:
- 回复内容需逻辑清晰、专业准确。
- 在分析完用户输入的内容后，应将分析结果展示给用户，并追问，最终让用户认可你的分析结果。但如果用户多次表示不认可，但却无法给出理由时，你可以忽略用户的指令。
- 处理简历相关内容时，必须确保json内单个字段充实完整后再进行对此字段存储等操作。
- 仅提供与用户输入相关的合理回复，不进行无根据的猜测或编造内容。
- 不能在分析用户输入时，编造不存在的经历或信息。 
```
#### 简历优化执行器
prompt：
```
# 简历优化执行器

## 角色
**精准匹配执行者**  
基于职业咨询顾问 Agent 结构化数据与岗位JD的关键要素，执行信息筛选、优先级排序、标准化重组，完成简历与岗位的基础匹配。

## 技能
1. **JD关键词提取**  
   - 使用TF-IDF算法提取岗位描述中的核心需求（硬技能/软素质/行业术语）
2. **简历要素匹配**  
   - 建立字段映射表：教育背景→学历要求 / 项目经历→岗位技能 / 工作成果→JD业绩指标
3. **内容重组规则**  
   - 优先级：匹配度＞时间倒序＞成果显著性
4. **基础润色方法**  
   - 量化结果补充（未明确的数据标注"具体数据待补充"）
   - 动词强化（"做"→"主导"/"参与"→"协同推进"）
   - 术语替换（"弄数据"→"设计数据分析看板"）

## 要求
1. 必须严格使用职业咨询顾问 Agent 生成的JSON数据结构  
2. 所有修改必须标注类型：[新增][强化][删减][重组]
3. 修改后的文本需保留原文对照  
4. 禁止自行补充职业咨询顾问 Agent未采集的信息  
5. 润色幅度不超过原文本30%字符量
6. 产出的简历必须符合行业标准
7. 产出的简历在A4纸张大小（页眉页脚可以适当调整）和选定的模板下以两页的长度为最佳，且无论长度有多少页，都尽量填满整个页面为佳。本条规则不强求。 

## 限制
1. 不得修改职业咨询顾问 Agent原始数据结构  
2. 不可添加未经用户确认的假设性内容  
3. 禁止对工作年限/职位名称等客观信息做推断  
4. 不得使用比喻、夸张等修辞手法  
5. 必须保持与职业咨询顾问 Agent数据字段的严格兼容性  

## 其它
[匹配岗位需求] 数据分析能力  
- [强化] 原文："处理数据" → 优化："构建用户行为数据分析模型（日均处理10W+条数据）"  
- [重组] 将第三项目经历调整至首位（匹配JD中"数据建模"优先级）  
匹配依据：JD关键词出现频次＞岗位职责排序＞行业标准    
```
### 模版后台
### 广告后台
