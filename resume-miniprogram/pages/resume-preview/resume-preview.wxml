<!--pages/resume-preview/resume-preview.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="header">
    <view class="header-left">
      <text class="back-button" bindtap="goToEdit">è¿”å›</text>
    </view>
    <view class="header-title">ç®€å†é¢„è§ˆ</view>
    <view class="header-right">
      <text class="template-button" bindtap="showTemplateSelector">æ›´æ¢æ¨¡æ¿</text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-container" wx:if="{{errorMessage && !loading}}">
    <text class="error-message">{{errorMessage}}</text>
    <button class="btn-retry" bindtap="goToEdit">è¿”å›</button>
  </view>

  <!-- ç®€å†é¢„è§ˆå†…å®¹ -->
  <view class="resume-container" wx:if="{{!loading && !errorMessage && resumeData}}">
    <!-- æ¨¡æ¿1ï¼šæ ‡å‡†æ¨¡æ¿ -->
    <view class="resume-template standard" wx:if="{{selectedTemplate === 1}}">
      <!-- ç®€å†æ ‡é¢˜ -->
      <view class="resume-header">
        <view class="resume-title">{{resumeData.title}}</view>
      </view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="resume-section">
        <view class="resume-personal">
          <view class="resume-name">{{resumeData.basicInfo.name}}</view>
          <view class="resume-contact">
            <text wx:if="{{resumeData.basicInfo.phone}}">{{resumeData.basicInfo.phone}}</text>
            <text wx:if="{{resumeData.basicInfo.phone && resumeData.basicInfo.email}}"> | </text>
            <text wx:if="{{resumeData.basicInfo.email}}">{{resumeData.basicInfo.email}}</text>
          </view>
          <view class="resume-info">
            <text wx:if="{{resumeData.basicInfo.location}}">{{resumeData.basicInfo.location}}</text>
            <text wx:if="{{resumeData.basicInfo.location && resumeData.basicInfo.position}}"> | </text>
            <text wx:if="{{resumeData.basicInfo.position}}">æ±‚èŒæ„å‘ï¼š{{resumeData.basicInfo.position}}</text>
          </view>
        </view>
        
        <view class="resume-summary" wx:if="{{resumeData.basicInfo.summary}}">
          <view class="section-title">ä¸ªäººç®€ä»‹</view>
          <view class="section-content">{{resumeData.basicInfo.summary}}</view>
        </view>
      </view>

      <!-- æ•™è‚²ç»å† -->
      <view class="resume-section" wx:if="{{resumeData.education.length > 0}}">
        <view class="section-title">æ•™è‚²ç»å†</view>
        <view class="section-items">
          <view class="section-item" wx:for="{{resumeData.education}}" wx:key="index">
            <view class="item-header">
              <view class="item-title">{{item.school}}</view>
              <view class="item-period">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
            </view>
            <view class="item-subtitle">{{item.degree}}ï¼Œ{{item.major}}</view>
            <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
          </view>
        </view>
      </view>

      <!-- å·¥ä½œç»éªŒ -->
      <view class="resume-section" wx:if="{{resumeData.experience.length > 0}}">
        <view class="section-title">å·¥ä½œç»éªŒ</view>
        <view class="section-items">
          <view class="section-item" wx:for="{{resumeData.experience}}" wx:key="index">
            <view class="item-header">
              <view class="item-title">{{item.company}}</view>
              <view class="item-period">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
            </view>
            <view class="item-subtitle">
              {{item.position}}
              <text wx:if="{{item.location}}">ï¼ˆ{{item.location}}ï¼‰</text>
            </view>
            <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
          </view>
        </view>
      </view>

      <!-- é¡¹ç›®ç»éªŒ -->
      <view class="resume-section" wx:if="{{resumeData.projects.length > 0}}">
        <view class="section-title">é¡¹ç›®ç»éªŒ</view>
        <view class="section-items">
          <view class="section-item" wx:for="{{resumeData.projects}}" wx:key="index">
            <view class="item-header">
              <view class="item-title">{{item.name}}</view>
              <view class="item-period" wx:if="{{item.startDate}}">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
            </view>
            <view class="item-subtitle">è§’è‰²ï¼š{{item.role}}</view>
            <view class="item-technology" wx:if="{{item.technologies}}">æŠ€æœ¯æ ˆï¼š{{item.technologies}}</view>
            <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
          </view>
        </view>
      </view>

      <!-- æŠ€èƒ½ç‰¹é•¿ -->
      <view class="resume-section" wx:if="{{resumeData.skills.length > 0}}">
        <view class="section-title">æŠ€èƒ½ç‰¹é•¿</view>
        <view class="section-skills">
          <view class="skill-tag" wx:for="{{resumeData.skills}}" wx:key="index">{{item}}</view>
        </view>
      </view>
    </view>

    <!-- æ¨¡æ¿2ï¼šä¸“ä¸šæ¨¡æ¿ -->
    <view class="resume-template professional" wx:if="{{selectedTemplate === 2}}">
      <!-- ç®€å†æ ‡é¢˜å’ŒåŸºæœ¬ä¿¡æ¯ -->
      <view class="resume-header professional-header">
        <view class="resume-name-title">
          <view class="resume-name">{{resumeData.basicInfo.name}}</view>
          <view class="resume-title">{{resumeData.basicInfo.position || 'æ±‚èŒè€…'}}</view>
        </view>
        <view class="resume-contact-info">
          <view class="contact-item" wx:if="{{resumeData.basicInfo.phone}}">
            <view class="contact-icon">ğŸ“±</view>
            <view class="contact-text">{{resumeData.basicInfo.phone}}</view>
          </view>
          <view class="contact-item" wx:if="{{resumeData.basicInfo.email}}">
            <view class="contact-icon">ğŸ“§</view>
            <view class="contact-text">{{resumeData.basicInfo.email}}</view>
          </view>
          <view class="contact-item" wx:if="{{resumeData.basicInfo.location}}">
            <view class="contact-icon">ğŸ“</view>
            <view class="contact-text">{{resumeData.basicInfo.location}}</view>
          </view>
        </view>
      </view>

      <!-- ä¸ªäººç®€ä»‹ -->
      <view class="resume-section professional-summary" wx:if="{{resumeData.basicInfo.summary}}">
        <view class="section-title">ä¸ªäººç®€ä»‹</view>
        <view class="section-content">{{resumeData.basicInfo.summary}}</view>
      </view>

      <!-- ä¸¤æ å¸ƒå±€ -->
      <view class="professional-layout">
        <!-- å·¦æ ï¼šæ•™è‚²ã€æŠ€èƒ½ -->
        <view class="professional-column left">
          <!-- æ•™è‚²ç»å† -->
          <view class="resume-section" wx:if="{{resumeData.education.length > 0}}">
            <view class="section-title">æ•™è‚²ç»å†</view>
            <view class="section-items">
              <view class="section-item" wx:for="{{resumeData.education}}" wx:key="index">
                <view class="item-title">{{item.school}}</view>
                <view class="item-subtitle">{{item.degree}}ï¼Œ{{item.major}}</view>
                <view class="item-period">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
                <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>

          <!-- æŠ€èƒ½ç‰¹é•¿ -->
          <view class="resume-section" wx:if="{{resumeData.skills.length > 0}}">
            <view class="section-title">æŠ€èƒ½ç‰¹é•¿</view>
            <view class="section-skills professional-skills">
              <view class="skill-item" wx:for="{{resumeData.skills}}" wx:key="index">{{item}}</view>
            </view>
          </view>
        </view>

        <!-- å³æ ï¼šå·¥ä½œã€é¡¹ç›® -->
        <view class="professional-column right">
          <!-- å·¥ä½œç»éªŒ -->
          <view class="resume-section" wx:if="{{resumeData.experience.length > 0}}">
            <view class="section-title">å·¥ä½œç»éªŒ</view>
            <view class="section-items">
              <view class="section-item" wx:for="{{resumeData.experience}}" wx:key="index">
                <view class="item-title">{{item.position}}</view>
                <view class="item-subtitle">{{item.company}}
                  <text wx:if="{{item.location}}">ï¼ˆ{{item.location}}ï¼‰</text>
                </view>
                <view class="item-period">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
                <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>

          <!-- é¡¹ç›®ç»éªŒ -->
          <view class="resume-section" wx:if="{{resumeData.projects.length > 0}}">
            <view class="section-title">é¡¹ç›®ç»éªŒ</view>
            <view class="section-items">
              <view class="section-item" wx:for="{{resumeData.projects}}" wx:key="index">
                <view class="item-title">{{item.name}} <text class="item-role">- {{item.role}}</text></view>
                <view class="item-period" wx:if="{{item.startDate}}">{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</view>
                <view class="item-technology" wx:if="{{item.technologies}}">æŠ€æœ¯æ ˆï¼š{{item.technologies}}</view>
                <view class="item-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¨¡æ¿3ï¼šåˆ›æ„æ¨¡æ¿ -->
    <view class="resume-template creative" wx:if="{{selectedTemplate === 3}}">
      <!-- åˆ›æ„å¤´éƒ¨ -->
      <view class="creative-header">
        <view class="creative-name">{{resumeData.basicInfo.name}}</view>
        <view class="creative-title">{{resumeData.basicInfo.position || 'æ±‚èŒè€…'}}</view>
        <view class="creative-contact">
          <text wx:if="{{resumeData.basicInfo.phone}}">{{resumeData.basicInfo.phone}}</text>
          <text class="separator" wx:if="{{resumeData.basicInfo.phone && resumeData.basicInfo.email}}">â€¢</text>
          <text wx:if="{{resumeData.basicInfo.email}}">{{resumeData.basicInfo.email}}</text>
          <text class="separator" wx:if="{{(resumeData.basicInfo.phone || resumeData.basicInfo.email) && resumeData.basicInfo.location}}">â€¢</text>
          <text wx:if="{{resumeData.basicInfo.location}}">{{resumeData.basicInfo.location}}</text>
        </view>
      </view>

      <!-- åˆ›æ„ç®€ä»‹ -->
      <view class="creative-about" wx:if="{{resumeData.basicInfo.summary}}">
        <view class="creative-section-title">å…³äºæˆ‘</view>
        <view class="creative-section-content">{{resumeData.basicInfo.summary}}</view>
      </view>

      <!-- åˆ›æ„æ—¶é—´çº¿ -->
      <view class="creative-timeline">
        <!-- æ•™è‚²ç»å† -->
        <view class="creative-section" wx:if="{{resumeData.education.length > 0}}">
          <view class="creative-section-title">æ•™è‚²ç»å†</view>
          <view class="timeline-items">
            <view class="timeline-item" wx:for="{{resumeData.education}}" wx:key="index">
              <view class="timeline-date">
                <text>{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</text>
              </view>
              <view class="timeline-content">
                <view class="timeline-title">{{item.school}}</view>
                <view class="timeline-subtitle">{{item.degree}}ï¼Œ{{item.major}}</view>
                <view class="timeline-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>
        </view>

        <!-- å·¥ä½œç»éªŒ -->
        <view class="creative-section" wx:if="{{resumeData.experience.length > 0}}">
          <view class="creative-section-title">å·¥ä½œç»éªŒ</view>
          <view class="timeline-items">
            <view class="timeline-item" wx:for="{{resumeData.experience}}" wx:key="index">
              <view class="timeline-date">
                <text>{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</text>
              </view>
              <view class="timeline-content">
                <view class="timeline-title">{{item.company}}</view>
                <view class="timeline-subtitle">
                  {{item.position}}
                  <text wx:if="{{item.location}}">ï¼ˆ{{item.location}}ï¼‰</text>
                </view>
                <view class="timeline-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>
        </view>

        <!-- é¡¹ç›®ç»éªŒ -->
        <view class="creative-section" wx:if="{{resumeData.projects.length > 0}}">
          <view class="creative-section-title">é¡¹ç›®ç»éªŒ</view>
          <view class="timeline-items">
            <view class="timeline-item" wx:for="{{resumeData.projects}}" wx:key="index">
              <view class="timeline-date" wx:if="{{item.startDate}}">
                <text>{{item.startDate}} - {{item.endDate || 'è‡³ä»Š'}}</text>
              </view>
              <view class="timeline-content">
                <view class="timeline-title">{{item.name}}</view>
                <view class="timeline-subtitle">è§’è‰²ï¼š{{item.role}}</view>
                <view class="timeline-technology" wx:if="{{item.technologies}}">
                  <text>æŠ€æœ¯æ ˆï¼š{{item.technologies}}</text>
                </view>
                <view class="timeline-description" wx:if="{{item.description}}">{{item.description}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- æŠ€èƒ½äº‘ -->
      <view class="creative-section" wx:if="{{resumeData.skills.length > 0}}">
        <view class="creative-section-title">æŠ€èƒ½ç‰¹é•¿</view>
        <view class="creative-skills">
          <view class="creative-skill-tag" wx:for="{{resumeData.skills}}" wx:key="index">{{item}}</view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="action-bar">
      <button class="action-button" bindtap="downloadResume">
        <view class="button-icon">ğŸ“¥</view>
        <view class="button-text">ä¸‹è½½</view>
      </button>
      <button class="action-button" open-type="share" bindtap="shareResume">
        <view class="button-icon">ğŸ”—</view>
        <view class="button-text">åˆ†äº«</view>
      </button>
      <button class="action-button" bindtap="applyJob">
        <view class="button-icon">ğŸ’¼</view>
        <view class="button-text">æŠ•é€’</view>
      </button>
      <button class="action-button" bindtap="goToEdit">
        <view class="button-icon">âœï¸</view>
        <view class="button-text">ç¼–è¾‘</view>
      </button>
    </view>
  </view>

  <!-- æ¨¡æ¿é€‰æ‹©å™¨å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showTemplateSelector}}" bindtap="hideTemplateSelector"></view>
  <view class="modal-container" wx:if="{{showTemplateSelector}}">
    <view class="modal-content" catchtap>
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æ¨¡æ¿</text>
        <text class="modal-close" bindtap="hideTemplateSelector">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="template-list">
          <view 
            class="template-item {{selectedTemplate === item.id ? 'selected' : ''}}" 
            wx:for="{{templates}}" 
            wx:key="id"
            bindtap="selectTemplate"
            data-id="{{item.id}}"
          >
            <image class="template-thumbnail" src="{{item.thumbnail}}" mode="aspectFit"></image>
            <view class="template-name">{{item.name}}</view>
            <view class="template-check" wx:if="{{selectedTemplate === item.id}}">âœ“</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 